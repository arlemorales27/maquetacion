<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HTML5 Tag Quest ‚Äî Retos simples (p√°gina final)</title>
    <style>
        :root{--bg:#0e0f1a;--panel:#15172b;--panel-2:#101226;--text:#e9ecff;--muted:#a5b0ff;--accent:#7c5cff;--accent-2:#31d0aa;--warn:#ffb057;--danger:#ff6b7a;--ok:#2ad18b;--shadow:0 20px 40px rgba(0,0,0,.35);}
        *{box-sizing:border-box}
        html,body{height:100%}
        body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:radial-gradient(1200px 700px at 20% -10%,#23264a,transparent),radial-gradient(900px 500px at 110% 10%,#1a1d3a,transparent),var(--bg);color:var(--text);}
        a{color:inherit;text-decoration:none}
        .app{display:grid;grid-template-rows:auto 1fr;min-height:100vh}
        header{position:sticky;top:0;z-index:3;background:linear-gradient(90deg,var(--panel),#131735 60%,var(--panel));box-shadow:var(--shadow);padding:14px 18px;border-bottom:1px solid #242853}
        .brand{display:flex;align-items:center;gap:12px}
        .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 0deg, var(--accent), var(--accent-2), var(--warn), var(--accent));filter:drop-shadow(0 6px 14px rgba(124,92,255,.35));}
        .brand h1{font-size:18px;margin:0;letter-spacing:.5px}
        .brand small{display:block;color:var(--muted)}

        .grid{display:grid;grid-template-columns:300px 1fr 420px;gap:16px;padding:18px;}
        .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid #242853;border-radius:18px;padding:14px;box-shadow:var(--shadow)}
        .panel h2{margin:.2rem 0 8px;font-size:16px;color:#cfd6ff}

        .score{position:sticky;top:84px}
        .meter{height:10px;background:#0b0d1c;border-radius:999px;overflow:hidden;border:1px solid #2a2f69}
        .meter>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0}
        .stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
        .stat{background:#0f1230;border:1px solid #262c66;border-radius:12px;padding:10px;text-align:center}
        .stat .num{font-weight:700;font-size:22px}
        .badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
        .badge{padding:8px 10px;border:1px dashed #3a428d;border-radius:12px;background:#0e1333;font-size:12px}

        .card{display:grid;grid-template-rows:auto auto auto 1fr auto;gap:12px}
        .tagname{font-size:28px;margin:0;letter-spacing:.4px}
        .category{color:var(--muted);font-size:13px}
        .definition{background:#0f1230;border:1px solid #2a2f69;border-radius:12px;padding:12px;line-height:1.5}
        .howto{background:#0f1230;border:1px dashed #2a2f69;border-radius:12px;padding:10px;color:#cdd3ff}
        .example{background:#0d1028;border:1px solid #27307c;border-radius:12px;padding:12px}
        pre{margin:0;overflow:auto;max-height:260px}
        code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;font-size:13px;}

        .challenge{background:#0d122c;border:1px solid #2a2f69;border-radius:14px;padding:12px}
        .q{font-weight:600;margin-bottom:8px}
        .options{display:grid;gap:8px;margin-bottom:10px}
        .option{display:block;border:1px solid #2a2f69;background:#0f1433;border-radius:10px;padding:10px;transition:transform .06s ease, border-color .3s}
        .option:hover{transform:translateY(-1px);border-color:#4a53c7}
        .option.selected{outline:2px solid #6d79ff}

        /* Builder de p√°gina completa */
        .builder{display:grid;gap:10px}
        .hint{font-size:12px;color:var(--muted)}
        .editor{display:grid;gap:8px}
        .editor label{font-size:12px;color:var(--muted)}
        textarea#pageInput{width:100%;min-height:200px;background:#0b1030;border:1px solid #2a2f69;border-radius:10px;color:var(--text);padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;font-size:13px}
        .controls{display:flex;gap:8px;flex-wrap:wrap}
        .btn{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(180deg,#1f2a78,#1a235f);border:1px solid #3f49aa;padding:10px 14px;border-radius:12px;box-shadow:0 6px 14px rgba(0,0,0,.25);font-weight:600}
        .btn.secondary{background:linear-gradient(180deg,#172058,#141b45);border-color:#303a8e}
        .muted{color:#b9c3ff}

        .pagePreview{display:grid;gap:6px}
        .pagePreview .muted{font-size:12px}
        iframe#pageFrame{width:100%;height:280px;border:1px solid #2a2f69;border-radius:10px;background:#0b1030}

        .ency{position:sticky;top:84px;max-height:calc(100vh - 120px);overflow:auto}
        .list{display:grid;gap:8px}
        .tagpill{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border:1px solid #2a2f69;border-radius:10px;background:#0e1231;font-size:12px}
        .tagpill.locked{opacity:.6}

        .toast{position:fixed;right:18px;bottom:18px;background:#0e1333;border:1px solid #2d346c;border-radius:12px;padding:12px;box-shadow:var(--shadow);display:none}

        .sparkle{position:absolute;pointer-events:none;inset:0;overflow:hidden}
        .sparkle i{position:absolute;width:6px;height:6px;background:radial-gradient(#fff,rgba(255,255,255,0));border-radius:999px;opacity:.6;animation:float 5s linear infinite}
        @keyframes float{from{transform:translateY(140vh)}to{transform:translateY(-20vh)}}

        .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;--dx:0px}
        .confetti i{position:absolute;width:8px;height:14px;background:conic-gradient(from 0deg,var(--accent),var(--warn),var(--accent-2));opacity:.9;transform:rotate(15deg);animation:fall 700ms ease-out forwards}
        @keyframes fall{to{transform:translate(var(--dx), 80vh) rotate(360deg);opacity:0}}

        @media (max-width: 1100px){
            .grid{grid-template-columns:1fr;}
            .ency,.score{position:relative;top:auto;max-height:none}
        }
    </style>
</head>
<body>
<div class="app">
    <header>
        <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
                <h1>HTML5 Tag Quest <small>‚Äî Retos simples que construyen una web üéÆ‚ú®</small></h1>
                <small class="muted">1) Lee definici√≥n y ejemplo ‚Ä¢ 2) Reto 1 (opci√≥n m√∫ltiple) ‚Ä¢ 3) Reto 2: a√±ade la etiqueta a TU p√°gina ‚Ä¢ 4) Comprobar.</small>
            </div>
        </div>
    </header>

    <div class="grid">
        <aside class="panel score" aria-labelledby="score-title">
            <h2 id="score-title">Progreso</h2>
            <div class="meter" aria-label="progreso"><span id="progress"></span></div>
            <div class="stats" role="group" aria-label="estad√≠sticas">
                <div class="stat" title="Puntos de experiencia"><div class="num" id="xp">0</div><div class="muted">XP</div></div>
                <div class="stat" title="Etiquetas dominadas"><div class="num" id="mastered">0</div><div class="muted">Dominadas</div></div>
            </div>
            <div class="badges" id="badges" aria-label="insignias"></div>
        </aside>

        <main class="panel card" aria-live="polite">
            <div>
                <div class="category" id="category">‚Äî</div>
                <h2 class="tagname" id="tagname">Etiqueta</h2>
            </div>
            <div class="definition" id="definition">Descripci√≥n de la etiqueta seleccionada.</div>
            <div class="howto">
                <strong>Reto 2 (problema simple):</strong> en el <em>Editor de p√°gina</em> a√±ade correctamente la etiqueta actual a tu documento. Cada reto suma y el resultado final ser√° <u>una sola p√°gina web</u>. Si la etiqueta va en <code>&lt;head&gt;</code>, col√≥cala all√≠; si es de contenido, ub√≠cala en <code>&lt;body&gt;</code> (mejor dentro de <code>&lt;main id="app"&gt;</code>).
            </div>
            <div class="example">
                <div class="muted" style="margin-bottom:6px">Ejemplo</div>
                <pre><code id="example"></code></pre>
            </div>
            <div class="challenge">
                <div class="q" id="question">Reto 1: ‚Ä¶</div>
                <div class="options" id="options"></div>
                <div class="q" style="margin-top:8px">Reto 2: construye tu p√°gina ‚Äî a√±ade la etiqueta</div>
                <div class="builder" id="builder">
                    <div class="hint" id="builderHint">Usa el bot√≥n para insertar una plantilla, o escribe directamente.</div>
                    <div class="editor">
                        <label for="pageInput">Editor de p√°gina (HTML completo)</label>
                        <textarea id="pageInput" spellcheck="false" placeholder="Aqu√≠ ver√°s el HTML de tu p√°gina en construcci√≥n"></textarea>
                        <div class="controls">
                            <a href="#" class="btn" id="btnInsert">‚ûï Insertar etiqueta actual</a>
                            <a href="#" class="btn secondary" id="btnReset">üóëÔ∏è Restablecer p√°gina</a>
                        </div>
                    </div>
                    <div class="pagePreview">
                        <div class="muted">Vista previa (iframe sin scripts)</div>
                        <iframe id="pageFrame" sandbox="allow-forms allow-pointer-lock allow-popups allow-modals"></iframe>
                    </div>
                </div>
            </div>
            <div class="controls">
                <a href="#" class="btn" id="btnCheck">‚úÖ Comprobar</a>
                <a href="#" class="btn secondary" id="btnNext">‚û°Ô∏è Siguiente etiqueta</a>
                <a href="#" class="btn secondary" id="btnRandom">üé≤ Pr√°ctica aleatoria</a>
                <span class="muted" id="feedback" style="margin-left:6px"></span>
            </div>
        </main>

        <aside class="panel ency" aria-labelledby="ency-title">
            <h2 id="ency-title">Enciclopedia de etiquetas</h2>
            <div class="list" id="tagList" role="list"></div>
        </aside>
    </div>
</div>

<div class="sparkle" aria-hidden="true" id="sparkles"></div>
<div class="confetti" aria-hidden="true" id="confetti"></div>
<div class="toast" id="toast"></div>

<script>
    /* Utilidades */
    function $(sel){ return document.querySelector(sel); }
    function $$(sel){ return Array.from(document.querySelectorAll(sel)); }
    function escapeHTML(s){ return s.replace(new RegExp('[&<>]','g'), function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;'}[m]; }); }

    /* Resaltado seguro (migrado a RegExp() para evitar conflictos) */
    function highlight(src){
        function coloredAttrs(v){
            return v.replace(new RegExp('([a-zA-Z:-]+)="(.*?)"','g'), function(_, a, b){
                return '<span style="color:#9fefff">'+a+'</span>="<span style="color:#ffd591">'+b+'</span>';
            });
        }
        var s = escapeHTML(src);
        s = s.replace(new RegExp('(&lt;\\/?)'+'([a-zA-Z0-9:-]+)'+'([^&]*?)'+'(\\/?&gt;)', 'g'),
            function(_, a, b, c, d){
                return a+'<span style="color:#7cc0ff">'+b+'</span><span style="color:#c3b9ff">'+coloredAttrs(c)+'</span>'+d;
            }
        );
        s = s.replace(new RegExp('(&lt;!--)'+'([\\s\\S]*?)'+'(--&gt;)', 'g'),
            function(_, a, b, c){ return '<span style="color:#6ee7b7">'+a+b+c+'</span>'; }
        );
        return s;
    }

    function toast(msg){ var t=$('#toast'); t.textContent=msg; t.style.display='block'; clearTimeout(t._timer); t._timer=setTimeout(function(){t.style.display='none';},2200); }
    (function sparkles(){ var w=$('#sparkles'); w.innerHTML=''; for(var i=0;i<24;i++){ var e=document.createElement('i'); e.style.left=Math.random()*100+'%'; e.style.animationDelay=(Math.random()*5)+'s'; e.style.opacity=.3+Math.random()*.6; w.appendChild(e);} })();
    function confettiBurst(n){ n=n||26; var box=$('#confetti'); for(var i=0;i<n;i++){ var c=document.createElement('i'); c.style.left=(50+(Math.random()*40-20))+'%'; c.style.top='20%'; c.style.setProperty('--dx',(Math.random()*200-100)+'px'); c.style.transform='translate('+(Math.random()*60-30)+'px,0) rotate('+(Math.random()*180)+'deg)'; box.appendChild(c); setTimeout(function(){c.remove();},700);} }

    /* Persistencia de la p√°gina construida */
    var PAGE_KEY = 'tagquest.page';
    function getInitialPage(){ return (
        `<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mi sitio en construcci√≥n</title>
</head>
<body>
  <main id="app">
    <!-- Construye tu p√°gina aqu√≠ etiqueta por etiqueta -->
  </main>
</body>
</html>`
    ); }
    function loadPage(){ return localStorage.getItem(PAGE_KEY) || getInitialPage(); }
    function savePage(html){ localStorage.setItem(PAGE_KEY, html); }

    /* Datos del juego */
    var tags=[];
    function add(name,cat,def,example,q,opts,okIndex,exp,isVoid){
        tags.push({name:name,category:cat,definition:def,example:example,question:{prompt:q,options:opts,correctIndex:okIndex,explanation:exp},mastered:false,void:!!isVoid});
    }

    /* === LISTA DE ETIQUETAS (50+ incluyendo multimedia, tablas, formularios, etc.) === */

    // Estructura / Metadatos
    add('html','Estructura','Elemento ra√≠z que envuelve todo el documento.',`<!doctype html>
<html lang="es">
  <head>...</head>
  <body>...</body>
</html>`,`¬øQu√© representa <html>?`,['El elemento ra√≠z del documento','Una lista','Un enlace'],0,'Es el contenedor total.');
    add('head','Estructura','Contiene metadatos y recursos no visibles directamente.',`<head>
  <meta charset="utf-8">
  <title>T√≠tulo</title>
</head>`,`¬øPara qu√© sirve <head>?`,['Para metadatos y recursos','Para el contenido principal','Para tablas'],0,'Configura el documento.');
    add('body','Estructura','Aloja el contenido visible de la p√°gina.',`<body>
  <h1>Hola</h1>
</body>`,`¬øQu√© aloja <body>?`,['El contenido visible','Solo scripts','Solo estilos'],0,'Todo lo que ves en la p√°gina.');
    add('meta','Metadatos','Declara metadatos (charset, viewport, SEO, etc.).',`<meta charset="utf-8">`,`¬øPara qu√© se usa <meta>?`,['Para metadatos','Para una lista','Para una cita'],0,'No muestra contenido.',true);
    add('title','Metadatos','T√≠tulo del documento (pesta√±a del navegador).',`<title>Mi sitio</title>`,`¬øD√≥nde aparece <title>?`,['En la pesta√±a/ventana','En el cuerpo','En el pie'],0,'No se renderiza en el cuerpo.');
    add('base','Metadatos','Define URL base para rutas relativas.',`<base href="https://ejemplo.com/">`,`¬øQu√© hace <base>?`,['Fija la URL base','Crea una tabla','Inserta una imagen'],0,'Afecta a los enlaces relativos.',true);
    add('link','Metadatos','Vincula recursos externos (CSS, iconos).',`<link rel="stylesheet" href="styles.css">`,`¬øQu√© hace <link>?`,['Vincula recursos externos','Resalta texto','Define una secci√≥n'],0,'Com√∫n para hojas de estilo.',true);
    add('style','Metadatos','Inserta CSS incrustado.',`<style>
  body{font-family:system-ui;}
</style>`,`¬øQu√© contiene <style>?`,['Reglas CSS','Datos tabulares','Citas'],0,'Mejor usar archivos externos cuando crece.');

    // Seccionado
    add('main','Seccionado','Contenido principal √∫nico del documento.',`<main>...contenido principal...</main>`,`¬øQu√© representa <main>?`,['El bloque principal','La barra lateral','El pie'],0,'Debe existir a lo sumo una vez.');
    add('header','Seccionado','Encabezado de p√°gina o secci√≥n.',`<header><h1>Mi sitio</h1></header>`,`¬øPara qu√© sirve <header>?`,['Encabezado de secci√≥n/p√°gina','Pie de p√°gina','Tabla de contenidos'],0,'Puede repetirse por secci√≥n.');
    add('nav','Seccionado','Agrupa enlaces de navegaci√≥n.',`<nav><a href="#_">Inicio</a> | <a href="#_">Acerca</a></nav>`,`¬øQu√© contiene <nav>?`,['Enlaces de navegaci√≥n','Solo im√°genes','Solo tablas'],0,'Ayuda a la accesibilidad.');
    add('section','Seccionado','Agrupa contenido con un encabezado.',`<section><h2>Tema</h2><p>Detalle.</p></section>`,`¬øCu√°ndo usar <section>?`,['Para agrupar con encabezado','Para citas extensas','Para datos tabulares'],0,'Debe tener encabezado propio.');
    add('article','Seccionado','Unidad independiente (post, noticia).',`<article><h2>Noticia</h2><p>Texto...</p></article>`,`¬øQu√© es <article>?`,['Contenido independiente','Contenedor sin sem√°ntica','Pie de p√°gina'],0,'Reutilizable y referenciable.');
    add('aside','Seccionado','Contenido complementario (barra lateral).',`<aside>Glosario, anuncios...</aside>`,`¬øQu√© tipo de contenido va en <aside>?`,['Complementario','T√≠tulo principal','Contenido cr√≠tico'],0,'Relacionado indirectamente.');
    add('footer','Seccionado','Pie de p√°gina o de secci√≥n.',`<footer>¬© 2025</footer>`,`¬øQu√© representa <footer>?`,['El pie de una secci√≥n/p√°gina','Navegaci√≥n global','Cita corta'],0,'Usable por secci√≥n.');

    // Encabezados
    add('h1','Encabezados','T√≠tulo de nivel 1.',`<h1>T√≠tulo 1</h1>`,`¬øQu√© indica <h1>?`,['T√≠tulo de nivel 1','Un enlace','Una l√≠nea'],0,'√ösalo para el t√≠tulo principal.');
    add('h2','Encabezados','T√≠tulo de nivel 2.',`<h2>Subt√≠tulo</h2>`,`¬øQu√© indica <h2>?`,['Nivel 2','Lista','Tabla'],0,'Jerarqu√≠a.');
    add('h3','Encabezados','T√≠tulo de nivel 3.',`<h3>Secci√≥n</h3>`,`¬øQu√© indica <h3>?`,['Nivel 3','Enlace','Cita'],0,'Jerarqu√≠a.');
    add('h4','Encabezados','T√≠tulo de nivel 4.',`<h4>Bloque</h4>`,`¬øQu√© indica <h4>?`,['Nivel 4','Imagen','C√≥digo'],0,'Jerarqu√≠a.');
    add('h5','Encabezados','T√≠tulo de nivel 5.',`<h5>Detalle</h5>`,`¬øQu√© indica <h5>?`,['Nivel 5','Tabla','Lista'],0,'Jerarqu√≠a.');
    add('h6','Encabezados','T√≠tulo de nivel 6.',`<h6>Nota</h6>`,`¬øQu√© indica <h6>?`,['Nivel 6','Formulario','Audio'],0,'Jerarqu√≠a.');

    // Agrupaci√≥n y listas
    add('p','Agrupaci√≥n','P√°rrafo de texto.',`<p>Un p√°rrafo claro y conciso.</p>`,`¬øQu√© define <p>?`,['Un p√°rrafo','Una lista','Una cita corta'],0,'No anides bloques dentro de <p>.');
    add('pre','Agrupaci√≥n','Texto preformateado (respeta espacios).',`<pre>  mantiene
  el espaciado</pre>`,`¬øQu√© conserva <pre>?`,['Espacios y saltos','Solo enlaces','Solo estilos'],0,'√ötil para c√≥digo.');
    add('blockquote','Agrupaci√≥n','Cita en bloque de otra fuente.',`<blockquote>Una cita larga.</blockquote>`,`¬øPara qu√© es <blockquote>?`,['Citas extensas','Resaltar palabras','Navegaci√≥n'],0,'Usa <cite> para la fuente.');
    add('ol','Listas','Lista ordenada numerada.',`<ol><li>Uno</li><li>Dos</li></ol>`,`<ol> crea‚Ä¶`,['Listas numeradas','Citas','Tablas'],0,'Con <li>.');
    add('ul','Listas','Lista desordenada con vi√±etas.',`<ul><li>Elemento</li></ul>`,`<ul> crea‚Ä¶`,['Listas con vi√±etas','Tablas','Encabezados'],0,'Con <li>.');
    add('li','Listas','Elemento de una lista.',`<ul><li>√çtem</li></ul>`,`¬øD√≥nde va <li>?`,['Dentro de listas','En <head>','En <table>'],0,'√çtem de lista.');
    add('dl','Listas','Lista de definiciones.',`<dl><dt>T√©rmino</dt><dd>Definici√≥n</dd></dl>`,`<dl> se usa para‚Ä¶`,['Definiciones','Tablas','Formularios'],0,'Con <dt> y <dd>.');
    add('dt','Listas','T√©rmino en una lista de definiciones.',`<dt>API</dt>`,`¬øQu√© es <dt>?`,['El t√©rmino','La descripci√≥n','Un enlace'],0,'Va dentro de <dl>.');
    add('dd','Listas','Descripci√≥n de un t√©rmino.',`<dd>Interfaz de programaci√≥n</dd>`,`¬øQu√© es <dd>?`,['La descripci√≥n','El t√©rmino','Una tabla'],0,'Junto a <dt>.');
    add('hr','Agrupaci√≥n','Separador tem√°tico; l√≠nea horizontal.',`<hr>`,`¬øQu√© hace <hr>?`,['Separa temas','Crea un encabezado','Vincula CSS'],0,'Elemento vac√≠o.',true);
    add('figure','Agrupaci√≥n','Unidad de contenido referenciable.',`<figure><img src="https://picsum.photos/200" alt=""><figcaption>Figura</figcaption></figure>`,`¬øQu√© agrupa <figure>?`,['Contenido aut√≥nomo con leyenda','Solo listas','Scripts'],0,'Con <figcaption>.');
    add('figcaption','Agrupaci√≥n','Leyenda de una figura.',`<figcaption>Mapa del sitio</figcaption>`,`¬øQu√© es <figcaption>?`,['Leyenda de figura','Pie de p√°gina','Enlace'],0,'Describe la figura.');
    add('div','Agrupaci√≥n','Contenedor gen√©rico sin sem√°ntica.',`<div class="tarjeta">Contenido</div>`,`¬øQu√© aporta <div>?`,['Contenedor gen√©rico','T√≠tulo sem√°ntico','Cita'],0,'Cuando no haya etiqueta m√°s espec√≠fica.');
    add('address','Seccionado','Informaci√≥n de contacto del autor/organizaci√≥n.',`<address>autor@dominio.tld</address>`,`¬øQu√© describe <address>?`,['Contacto del autor','Cualquier direcci√≥n postal','Datos tabulares'],0,'Asociado al autor/propietario.');

    // Texto en l√≠nea (sem√°ntica)
    add('a','Texto en l√≠nea','Hiperv√≠nculo.',`<a href="#_">Ir</a>`,`¬øQu√© crea <a>?`,['Un enlace','Un encabezado','Una tabla'],0,'Usa href, target, rel.');
    add('em','Texto en l√≠nea','√ânfasis sem√°ntico.',`<p>Esto es <em>importante</em>.</p>`,`<em> indica‚Ä¶`,['√ânfasis sem√°ntico','Subrayado','C√≥digo'],0,'Lectores de pantalla lo remarcan.');
    add('strong','Texto en l√≠nea','Mayor √©nfasis.',`<strong>¬°Atenci√≥n!</strong>`,`<strong> indica‚Ä¶`,['√ânfasis fuerte','Tachado','Cita'],0,'M√°s importante que <em>.');
    add('small','Texto en l√≠nea','Notas secundarias.',`<small>T√©rminos y condiciones</small>`,`<small> se usa para‚Ä¶`,['Notas secundarias','C√≥digo','Encabezados'],0,'Para anotaciones.');
    add('s','Texto en l√≠nea','Contenido no vigente (tachado).',`<s>Precio antiguo</s>`,`¬øQu√© denota <s>?`,['No vigente/incorrecto','Cita corta','Lista'],0,'No confundir con <del>.');
    add('cite','Texto en l√≠nea','Referencia a t√≠tulo de obra.',`<cite>El Quijote</cite>`,`¬øQu√© referencia <cite>?`,['T√≠tulo de obra','URL','C√≥digo'],0,'√ötil con citas.');
    add('q','Texto en l√≠nea','Cita breve en l√≠nea.',`<q>No te rindas</q>`,`<q> representa‚Ä¶`,['Cita breve','C√≥digo','Tabla'],0,'El navegador agrega comillas.');
    add('dfn','Texto en l√≠nea','Marca la definici√≥n de un t√©rmino.',`<p><dfn>API</dfn>: conjunto‚Ä¶</p>`,`¬øQu√© marca <dfn>?`,['Definici√≥n de t√©rmino','Un enlace','Un error'],0,'Primera aparici√≥n.');
    add('abbr','Texto en l√≠nea','Abreviatura con expansi√≥n.',`<abbr title="Cascading Style Sheets">CSS</abbr>`,`¬øC√≥mo se usa <abbr>?`,['Abreviaturas con title','Tablas','Navegaci√≥n'],0,'Proporciona "title".');
    add('data','Texto en l√≠nea','Valor legible por m√°quina.',`<data value="1200">1,2k</data>`,`¬øQu√© aporta <data>?`,['Valor legible por m√°quina','Cita','Lista'],0,'Microdatos.');
    add('time','Texto en l√≠nea','Fecha/hora con datetime.',`<time datetime="2025-08-27">27 de agosto de 2025</time>`,`<time> sirve para‚Ä¶`,['Marcar fechas/horas','Enlaces','Tablas'],0,'Mejora sem√°ntica.');
    add('code','Texto en l√≠nea','Fragmento de c√≥digo.',`<code>console.log("Hola")</code>`,`¬øQu√© marca <code>?`,['C√≥digo','√ânfasis','Cita'],0,'Para bloques usa <pre>.');
    add('var','Texto en l√≠nea','Variable (matem√°tica/c√≥digo).',`<p>Sea <var>n</var> un entero.</p>`,`¬øQu√© representa <var>?`,['Una variable','Una URL','Una cita'],0,'Sem√°ntica t√©cnica.');
    add('samp','Texto en l√≠nea','Salida de programa.',`<samp>Error 404</samp>`,`<samp> representa‚Ä¶`,['Salida de programa','Entrada de usuario','Lista'],0,'√ötil con <kbd>.');
    add('kbd','Texto en l√≠nea','Entrada del usuario/teclado.',`<kbd>Ctrl</kbd> + <kbd>C</kbd>`,`<kbd> es para‚Ä¶`,['Entrada de usuario','Variables','Citas'],0,'Atajos.');
    add('sub','Texto en l√≠nea','Sub√≠ndice.',`H<sub>2</sub>O`,`<sub> produce‚Ä¶`,['Sub√≠ndice','Super√≠ndice','Tachado'],0,'F√≥rmulas.');
    add('sup','Texto en l√≠nea','Super√≠ndice.',`x<sup>2</sup>`,`<sup> produce‚Ä¶`,['Super√≠ndice','Sub√≠ndice','Lista'],0,'Potencias.');
    add('i','Texto en l√≠nea','Voz/tono alterno.',`<i>palabra extranjera</i>`,`<i> indica‚Ä¶`,['Voz/tono alterno','√ânfasis fuerte','C√≥digo'],0,'No confundir con <em>.');
    add('b','Texto en l√≠nea','Llamar atenci√≥n sin importancia sem√°ntica.',`<b>Nuevo</b>`,`<b> se usa para‚Ä¶`,['Llamar atenci√≥n','√ânfasis sem√°ntico','Citas'],0,'No reemplaza <strong>.');
    add('u','Texto en l√≠nea','Anotaci√≥n no textual (convenci√≥n).',`<u>error ortogr√°fico</u>`,`<u> sugiere‚Ä¶`,['Anotaci√≥n no textual','Cita','Lista'],0,'Evita confusi√≥n con enlaces.');
    add('mark','Texto en l√≠nea','Resaltado por relevancia.',`<mark>palabra clave</mark>`,`<mark> sirve para‚Ä¶`,['Resaltar por relevancia','T√≠tulo','Tabla'],0,'Como marcador.');
    add('bdi','Texto en l√≠nea','A√≠sla direccionalidad.',`<bdi>ÿπÿ±ÿ®Ÿâ</bdi>`,`¬øQu√© hace <bdi>?`,['A√≠sla direcci√≥n','Crea tablas','Define listas'],0,'√ötil con RTL.');
    add('bdo','Texto en l√≠nea','Fuerza la direccionalidad (dir=ltr/rtl).',`<bdo dir="rtl">texto</bdo>`,`<bdo> permite‚Ä¶`,['Forzar direcci√≥n del texto','√ânfasis','C√≥digo'],0,'Usar con cuidado.');
    add('span','Texto en l√≠nea','Contenedor en l√≠nea gen√©rico.',`<span class="nota">Nota</span>`,`¬øQu√© es <span>?`,['Contenedor gen√©rico','Encabezado','Cita'],0,'Sin sem√°ntica espec√≠fica.');
    add('br','Texto en l√≠nea','Salto de l√≠nea.',`L√≠nea 1<br>L√≠nea 2`,`<br> inserta‚Ä¶`,['Un salto de l√≠nea','Un espacio','Una tabla'],0,'Elemento vac√≠o.',true);
    add('wbr','Texto en l√≠nea','Sugerencia de corte de palabra.',`anti<wbr>constitucional`,`¬øQu√© sugiere <wbr>?`,['Posible salto dentro de palabra','√ânfasis','Cita'],0,'Mejora maquetaci√≥n.',true);

    // Tablas
    add('table','Tablas','Tabla de datos.',`<table>
  <tr><th>Nombre</th><th>Puntos</th></tr>
  <tr><td>Ada</td><td>99</td></tr>
</table>`,`<table> crea‚Ä¶`,['Una tabla de datos','Una lista','Un encabezado'],0,'Usa secciones sem√°nticas.');
    add('caption','Tablas','T√≠tulo/leyenda de tabla.',`<table>
  <caption>Puntuaciones</caption>
</table>`,`¬øQu√© es <caption>?`,['T√≠tulo de la tabla','Celda','Lista'],0,'Primer hijo de <table>.');
    add('colgroup','Tablas','Grupo de columnas para estilos.',`<colgroup>
  <col span="2">
</colgroup>`,`<colgroup> sirve para‚Ä¶`,['Agrupar columnas','Filas de encabezado','Pies de tabla'],0,'Con <col>.');
    add('col','Tablas','Propiedades de columnas.',`<col span="1">`,`<col> define‚Ä¶`,['Propiedades de columnas','Celdas','Filas'],0,'Hijo de <colgroup>/<table>.',true);
    add('thead','Tablas','Encabezado de tabla.',`<thead><tr><th>Col</th></tr></thead>`,`<thead> contiene‚Ä¶`,['Encabezados de columna','Datos','Pie'],0,'Accesibilidad.');
    add('tbody','Tablas','Cuerpo de datos.',`<tbody><tr><td>Dato</td></tr></tbody>`,`<tbody> es‚Ä¶`,['Cuerpo de datos','Encabezado','Leyenda'],0,'Puede haber varios.');
    add('tfoot','Tablas','Pie de tabla (totales).',`<tfoot><tr><td>Total</td></tr></tfoot>`,`<tfoot> suele contener‚Ä¶`,['Totales/res√∫menes','Encabezados','Scripts'],0,'Al final l√≥gico.');
    add('tr','Tablas','Fila de una tabla.',`<tr><td>A</td><td>B</td></tr>`,`<tr> representa‚Ä¶`,['Una fila','Una columna','Encabezado'],0,'Contiene celdas.');
    add('th','Tablas','Celda de encabezado.',`<th scope="col">Nombre</th>`,`<th> es‚Ä¶`,['Celda de encabezado','Cita','Lista'],0,'Usa scope.');
    add('td','Tablas','Celda de datos.',`<td>42</td>`,`<td> es‚Ä¶`,['Celda de datos','Encabezado','Leyenda'],0,'Contenido tabular.');

    // Multimedia y embebidos
    add('img','Multimedia','Imagen embebida.',`<img src="https://picsum.photos/200" alt="Ejemplo">`,`¬øQu√© inserta <img>?`,['Una imagen','Un video','Una tabla'],0,'Usa alt.',true);
    add('picture','Multimedia','Contenedor para im√°genes responsivas.',`<picture>
  <source srcset="foto.avif" type="image/avif">
  <img src="foto.jpg" alt="Foto">
</picture>`,`¬øPara qu√© sirve <picture>?`,['Im√°genes responsivas','Audio','Tablas'],0,'Con <source> e <img>.');
    add('source','Multimedia','Fuente para <audio>, <video> o <picture>.',`<source src="video.mp4" type="video/mp4">`,`¬øD√≥nde va <source>?`,['Dentro de audio/video/picture','En <head>','En <table>'],0,'Elemento vac√≠o.',true);
    add('video','Multimedia','Reproductor de video.',`<video controls width="300">
  <source src="clip.mp4" type="video/mp4">
</video>`,`¬øQu√© crea <video>?`,['Un reproductor de video','Una lista','Un encabezado'],0,'Atributos: controls, loop, muted‚Ä¶');
    add('audio','Multimedia','Reproductor de audio.',`<audio controls>
  <source src="audio.ogg" type="audio/ogg">
</audio>`,`¬øQu√© crea <audio>?`,['Un reproductor de audio','Una tabla','Una cita'],0,'Atributos: controls, autoplay‚Ä¶');
    add('track','Multimedia','Pistas de texto (subt√≠tulos) para medios.',`<track kind="captions" src="sub.vtt" srclang="es" label="Espa√±ol">`,`¬øPara qu√© es <track>?`,['Subt√≠tulos/captions','Im√°genes','Listas'],0,'Elemento vac√≠o.',true);
    add('map','Multimedia','Mapa de im√°genes con √°reas clicables.',`<map name="mapa"><area shape="rect" coords="10,10,100,80" href="#_" alt="√Årea"></map>`,`¬øQu√© define <map>?`,['Regiones clicables','Tabla','Lista'],0,'Usa con <img usemap>.');
    add('area','Multimedia','√Årea en un <map>.',`<area shape="circle" coords="50,50,40" href="#_" alt="Zona">`,`¬øQu√© representa <area>?`,['Zona de un mapa de imagen','Encabezado','Formulario'],0,'Elemento vac√≠o.',true);
    add('iframe','Embebido','Documento embebido (otra p√°gina).',`<iframe src="about:blank" title="Marco"></iframe>`,`¬øQu√© inserta <iframe>?`,['Un documento embebido','Una imagen','Un audio'],0,'Aisla contexto.');
    add('embed','Embebido','Contenido externo (por tipo).',`<embed src="demo.svg" type="image/svg+xml">`,`¬øQu√© hace <embed>?`,['Incrusta contenido externo','Lista','Cita'],0,'Elemento vac√≠o.',true);
    add('object','Embebido','Contenedor gen√©rico para contenido externo.',`<object data="movie.mp4" type="video/mp4"><param name="autoplay" value="false"></param></object>`,`<object> sirve para‚Ä¶`,['Incrustar contenido','Tablas','Encabezados'],0,'Puede incluir <param>.');
    add('param','Embebido','Par√°metro para <object>.',`<param name="autoplay" value="false">`,`¬øD√≥nde va <param>?`,['Dentro de <object>','En <head>','En <table>'],0,'Elemento vac√≠o.',true);
    add('canvas','Gr√°ficos','Lienzo para gr√°ficos con JS.',`<canvas width="300" height="150">No soportado</canvas>`,`¬øQu√© es <canvas>?`,['Lienzo de dibujo','Tabla','Lista'],0,'Se maneja con JS.');

    // Formularios
    add('form','Formularios','Formulario interactivo.',`<form action="#_" method="post">
  <label for="n">Nombre</label>
  <input id="n" name="n">
  <button>Enviar</button>
</form>`,`¬øQu√© crea <form>?`,['Un formulario','Una tabla','Un video'],0,'Atributos: action, method.');
    add('label','Formularios','Etiqueta asociada a un control.',`<label for="n">Nombre</label>`,`¬øPara qu√© sirve <label>?`,['Asociar texto al control','Insertar imagen','Crear tabla'],0,'Usa for/id.');
    add('input','Formularios','Control de entrada (varios tipos).',`<input type="email" placeholder="tucorreo@...">`,`¬øQu√© es <input>?`,['Control de entrada','Contenedor gen√©rico','Leyenda'],0,'Elemento vac√≠o, usa type.',true);
    add('textarea','Formularios','√Årea de texto multi-l√≠nea.',`<textarea rows="3" cols="30">Texto</textarea>`,`¬øQu√© es <textarea>?`,['Entrada multi-l√≠nea','Imagen','Lista'],0,'Usa rows/cols.');
    add('button','Formularios','Bot√≥n de acci√≥n.',`<button type="button">Click</button>`,`¬øQu√© crea <button>?`,['Un bot√≥n','Un enlace','Una tabla'],0,'type=button|submit|reset.');
    add('select','Formularios','Lista desplegable.',`<select><option>Uno</option></select>`,`¬øQu√© es <select>?`,['Selector de opciones','Tabla','Texto preformateado'],0,'Con <option>/<optgroup>.');
    add('datalist','Formularios','Sugerencias para <input list>.',`<datalist id="sug"><option value="A"><option value="B"></datalist>`,`¬øPara qu√© sirve <datalist>?`,['Sugerencias de entrada','Tablas','Im√°genes'],0,'Se enlaza con input[list].');
    add('option','Formularios','Opci√≥n dentro de select/datalist.',`<option value="x">X</option>`,`¬øQu√© representa <option>?`,['Una opci√≥n','Una fila','Una celda'],0,'Hija de select/optgroup.');
    add('optgroup','Formularios','Grupo de opciones.',`<optgroup label="Grupo"><option>A</option></optgroup>`,`¬øQu√© es <optgroup>?`,['Agrupa opciones','Define estilos','Inserta scripts'],0,'Hija de select.');
    add('fieldset','Formularios','Agrupa controles relacionados.',`<fieldset><legend>Contacto</legend>...</fieldset>`,`¬øPara qu√© <fieldset>?`,['Agrupar controles','Insertar imagen','Encabezado'],0,'Con <legend>.');
    add('legend','Formularios','T√≠tulo de un fieldset.',`<legend>Datos</legend>`,`¬øQu√© es <legend>?`,['T√≠tulo de grupo','Celda','Lista'],0,'Primera hija de fieldset.');
    add('output','Formularios','Resultado calculado.',`<output for="a b">0</output>`,`¬øQu√© muestra <output>?`,['Resultados','Citas','Im√°genes'],0,'Puede asociarse a controles.');
    add('progress','Formularios','Barra de progreso.',`<progress value="40" max="100">40%</progress>`,`¬øQu√© muestra <progress>?`,['Progreso','Tabla','Cita'],0,'Valor entre 0 y max.');
    add('meter','Formularios','Medidor escalar/con rangos.',`<meter min="0" max="100" low="30" high="70" value="65">65</meter>`,`¬øQu√© muestra <meter>?`,['Medida en un rango','Lista','Imagen'],0,'Buen uso de low/high.');

    // Interactivos / Scripting / Web Components
    add('details','Interactivo','Mostrar/ocultar contenido a demanda.',`<details><summary>M√°s info</summary><p>Contenido.</p></details>`,`<details> permite‚Ä¶`,['Mostrar/ocultar contenido','Crear formularios','Reproducir video'],0,'Usa <summary>.');
    add('summary','Interactivo','Cabecera visible de <details>.',`<details><summary>Ver detalles</summary>...</details>`,`<summary> es‚Ä¶`,['Encabezado clicable de details','Pie de tabla','Enlace externo'],0,'Primer hijo de <details>.');
    add('dialog','Interactivo','Cuadro de di√°logo modal/no modal.',`<dialog open>Hola</dialog>`,`¬øQu√© crea <dialog>?`,['Cuadros de di√°logo','Tablas','Citas'],0,'Controlable con JS.');
    add('script','Scripting','Inserta o referencia scripts.',`<script>console.log("hola")<\/script>`,`<script> sirve para‚Ä¶`,['Ejecutar JS','Aplicar estilos','Definir tablas'],0,'Usa defer para no bloquear.');
    add('noscript','Scripting','Contenido alternativo si JS est√° deshabilitado.',`<noscript>Activa JavaScript para ver este sitio.</noscript>`,`¬øCu√°ndo aparece <noscript>?`,['Cuando JS no est√° disponible','Siempre','En impresiones'],0,'Contenido de reserva.');
    add('template','Scripting','Marcado inerte para clonar con JS.',`<template id="card">
  <article class="card">...</article>
</template>`,`<template> contiene‚Ä¶`,['Marcado inerte para clonar','CSS global','Datos de tabla'],0,'No se renderiza hasta usar JS.');
    add('slot','Web Components','Punto de inserci√≥n de contenido en un componente.',`<slot name="titulo"></slot>`,`¬øQu√© es <slot>?`,['Ranura de contenido','Lista','Tabla'],0,'Uso en custom elements.');

    /* === FIN DE LA LISTA === */

    /* Estado y elementos */
    var index=0, selectedOption=null, xp=0;
    var els={
        category:$('#category'),
        tagname:$('#tagname'),
        definition:$('#definition'),
        example:$('#example'),
        question:$('#question'),
        options:$('#options'),
        progress:$('#progress'),
        xp:$('#xp'),
        mastered:$('#mastered'),
        list:$('#tagList'),
        feedback:$('#feedback'),
        badges:$('#badges'),
        builder:$('#builder'),
        builderHint:$('#builderHint'),
        pageInput:$('#pageInput'),
        pageFrame:$('#pageFrame'),
        btnInsert:$('#btnInsert'),
        btnReset:$('#btnReset')
    };

    /* Secciones esperadas para cada etiqueta */
    var HEAD_ONLY = new Set(['base','link','meta','style','title']);
    function expectedSectionForTag(name){
        name = (name||'').toLowerCase();
        if(name==='html'||name==='head'||name==='body') return 'pre'; // ya est√°n en el esqueleto
        if(HEAD_ONLY.has(name)) return 'head';
        if(name==='script' || name==='noscript') return 'any';
        return 'body';
    }

    function sectionContent(html, section){
        var re = new RegExp('<'+section+'[^>]*>([\\s\\S]*?)<\\/'+section+'>','i');
        var m = html.match(re); return m? m[1] : '';
    }
    function hasTag(src, tag, isVoid){
        var t = tag.replace(new RegExp('[.*+?^${}()|[\\]\\\\]','g'),'\\$&');
        if(isVoid){
            var re = new RegExp('<\\s*'+t+'(?:\\s+[^>]*)?>','i');
            return re.test(src);
        }else{
            var re2 = new RegExp('<\\s*'+t+'(?:\\s+[^>]*)?>[\\s\\S]*?<\\/\\s*'+t+'\\s*>','i');
            return re2.test(src);
        }
    }

    function sanitizeForPreview(html){
        // El iframe est√° sin allow-scripts, as√≠ que es suficiente
        return html;
    }

    function renderPagePreview(){
        var html = els.pageInput.value || getInitialPage();
        els.pageFrame.srcdoc = sanitizeForPreview(html);
    }

    function insertSnippetFor(tag){
        var name = tag.name.toLowerCase();
        var v = tag.void;
        var tpl = '';

        // HEAD
        if(name==='link') tpl = '<link rel="stylesheet" href="styles.css">';
        else if(name==='meta') tpl = '<meta name="description" content="Descripci√≥n de la p√°gina">';
        else if(name==='style') tpl = '<style>/* estilos */\nbody{font-family:system-ui;}\n</style>';
        else if(name==='base') tpl = '<base href="https://ejemplo.com/">';

        // Seccionado y estructura
        else if(name==='nav') tpl = '<nav><a href="#_">Inicio</a> ¬∑ <a href="#_">Acerca</a></nav>';
        else if(name==='header') tpl = '<header><h1>Mi sitio</h1></header>';
        else if(name==='section') tpl = '<section><h2>T√≠tulo de secci√≥n</h2><p>Contenido‚Ä¶</p></section>';
        else if(name==='article') tpl = '<article><h2>T√≠tulo del art√≠culo</h2><p>Texto‚Ä¶</p></article>';
        else if(name==='aside') tpl = '<aside>Contenido complementario‚Ä¶</aside>';
        else if(name==='footer') tpl = '<footer>¬© 2025</footer>';
        else if(name==='h1') tpl = '<h1>Encabezado principal</h1>';
        else if(name==='h2' || name==='h3' || name==='h4' || name==='h5' || name==='h6') tpl = '<'+name+'>T√≠tulo '+name.toUpperCase()+'</'+name+'>';

        // Listas y agrupaci√≥n
        else if(name==='ul') tpl = '<ul>\n  <li>Uno</li>\n  <li>Dos</li>\n</ul>';
        else if(name==='ol') tpl = '<ol>\n  <li>Primero</li>\n  <li>Segundo</li>\n</ol>';
        else if(name==='li') tpl = '<li>Elemento</li>';
        else if(name==='dl') tpl = '<dl>\n  <dt>T√©rmino</dt>\n  <dd>Definici√≥n</dd>\n</dl>';
        else if(name==='pre') tpl = '<pre>  texto\n  preformateado</pre>';
        else if(name==='blockquote') tpl = '<blockquote>Una cita larga‚Ä¶</blockquote>';
        else if(name==='figure') tpl = '<figure>\n  <img src="https://picsum.photos/320/180" alt="Ejemplo">\n  <figcaption>Figura de ejemplo</figcaption>\n</figure>';
        else if(name==='figcaption') tpl = '<figcaption>Descripci√≥n de la figura</figcaption>';
        else if(name==='address') tpl = '<address>autor@dominio.tld</address>';
        else if(name==='div') tpl = '<div class="tarjeta">Contenido</div>';
        else if(name==='hr') tpl = '<hr>';

        // Texto en l√≠nea
        else if(name==='a') tpl = '<a href="#_">Un enlace</a>';
        else if(name==='em' || name==='i' || name==='b' || name==='u' || name==='strong' || name==='small' || name==='s' || name==='mark' || name==='span' || name==='bdi' || name==='bdo' || name==='q' || name==='cite' || name==='dfn' || name==='abbr' || name==='data' || name==='time' || name==='code' || name==='var' || name==='samp' || name==='kbd' || name==='sub' || name==='sup'){
            if(name==='abbr') tpl = '<abbr title="Cascading Style Sheets">CSS</abbr>';
            else if(name==='data') tpl = '<data value="1200">1,2k</data>';
            else if(name==='time') tpl = '<time datetime="2025-08-27">27 de agosto de 2025</time>';
            else if(name==='bdo') tpl = '<bdo dir="rtl">texto</bdo>';
            else if(name==='q') tpl = '<q>Cita breve</q>';
            else tpl = '<'+name+'>Texto de ejemplo</'+name+'>';
        }
        else if(name==='br') tpl = 'L√≠nea 1<br>L√≠nea 2';
        else if(name==='wbr') tpl = 'anti<wbr>constitucional';

        // Tablas
        else if(name==='table') tpl = '<table>\n  <caption>Tabla demo</caption>\n  <thead><tr><th>Col</th><th>Col</th></tr></thead>\n  <tbody><tr><td>A</td><td>B</td></tr></tbody>\n  <tfoot><tr><td colspan="2">Total</td></tr></tfoot>\n</table>';
        else if(name==='caption') tpl = '<caption>Mi tabla</caption>';
        else if(name==='colgroup') tpl = '<colgroup>\n  <col span="2">\n</colgroup>';
        else if(name==='col') tpl = '<col span="1">';
        else if(name==='thead') tpl = '<thead><tr><th>Col</th></tr></thead>';
        else if(name==='tbody') tpl = '<tbody><tr><td>Dato</td></tr></tbody>';
        else if(name==='tfoot') tpl = '<tfoot><tr><td>Pie</td></tr></tfoot>';
        else if(name==='tr') tpl = '<tr><td>A</td><td>B</td></tr>';
        else if(name==='th') tpl = '<th scope="col">Encabezado</th>';
        else if(name==='td') tpl = '<td>Dato</td>';

        // Multimedia / Embebidos
        else if(name==='img') tpl = '<img src="https://picsum.photos/200" alt="Ejemplo">';
        else if(name==='picture') tpl = '<picture>\n  <source srcset="foto.avif" type="image/avif">\n  <img src="foto.jpg" alt="Foto">\n</picture>';
        else if(name==='source') tpl = '<source src="media.mp4" type="video/mp4">';
        else if(name==='video') tpl = '<video controls width="320">\n  <source src="clip.mp4" type="video/mp4">\n  <track kind="captions" src="sub.vtt" srclang="es" label="ES">\n</video>';
        else if(name==='audio') tpl = '<audio controls>\n  <source src="audio.ogg" type="audio/ogg">\n</audio>';
        else if(name==='track') tpl = '<track kind="captions" src="sub.vtt" srclang="es" label="Espa√±ol">';
        else if(name==='map') tpl = '<map name="map-ej">\n  <area shape="rect" coords="10,10,120,80" href="#_" alt="√Årea 1">\n</map>';
        else if(name==='area') tpl = '<area shape="circle" coords="50,50,40" href="#_" alt="Zona">';
        else if(name==='iframe') tpl = '<iframe src="about:blank" title="Marco"></iframe>';
        else if(name==='embed') tpl = '<embed src="demo.svg" type="image/svg+xml">';
        else if(name==='object') tpl = '<object data="movie.mp4" type="video/mp4"><param name="autoplay" value="false"></param></object>';
        else if(name==='param') tpl = '<param name="autoplay" value="false">';
        else if(name==='canvas') tpl = '<canvas width="300" height="150">Tu navegador no soporta canvas</canvas>';

        // Formularios
        else if(name==='form') tpl = '<form action="#_" method="post">\n  <label for="n">Nombre</label>\n  <input id="n" name="n" type="text">\n  <button>Enviar</button>\n</form>';
        else if(name==='label') tpl = '<label for="n">Nombre</label>';
        else if(name==='input') tpl = '<input type="text" placeholder="Escribe...">';
        else if(name==='textarea') tpl = '<textarea rows="3" cols="30">Texto</textarea>';
        else if(name==='button') tpl = '<button type="button">Click</button>';
        else if(name==='select') tpl = '<select>\n  <option>Uno</option>\n  <option>Dos</option>\n</select>';
        else if(name==='datalist') tpl = '<datalist id="sugerencias">\n  <option value="A">\n  <option value="B">\n</datalist>';
        else if(name==='option') tpl = '<option value="x">X</option>';
        else if(name==='optgroup') tpl = '<optgroup label="Grupo">\n  <option>Opci√≥n</option>\n</optgroup>';
        else if(name==='fieldset') tpl = '<fieldset>\n  <legend>Contacto</legend>\n  <label>Email <input type="email"></label>\n</fieldset>';
        else if(name==='legend') tpl = '<legend>Informaci√≥n</legend>';
        else if(name==='output') tpl = '<output for="a b">0</output>';
        else if(name==='progress') tpl = '<progress value="40" max="100">40%</progress>';
        else if(name==='meter') tpl = '<meter min="0" max="100" low="30" high="70" value="65">65</meter>';

        // Interactivos / Scripting
        else if(name==='details') tpl = '<details><summary>Ver m√°s</summary><p>Contenido oculto‚Ä¶</p></details>';
        else if(name==='summary') tpl = '<summary>Resumen</summary>';
        else if(name==='dialog') tpl = '<dialog open>Hola</dialog>';
        else if(name==='script') tpl = '<script>console.log("hola")<\/script>';
        else if(name==='noscript') tpl = '<noscript>Activa JavaScript para ver este sitio.</noscript>';
        else if(name==='template') tpl = '<template id="card"><article class="card">...</article></template>';
        else if(name==='slot') tpl = '<slot name="titulo"></slot>';

        // Gen√©rico
        else if(v) tpl = '<'+name+'>';
        else tpl = '<'+name+'>Contenido de &lt;'+name+'&gt;</'+name+'>';

        return tpl;
    }

    function insertCurrentTag(){
        var t = tags[index];
        var html = els.pageInput.value || '';
        var section = expectedSectionForTag(t.name);
        var tpl = insertSnippetFor(t);
        var already = hasTag(html, t.name, t.void);
        if(already){ toast('Ya hay un <'+t.name+'> en la p√°gina.'); return; }
        if(!html.trim()) html = getInitialPage();

        if(section==='head'){
            if(!new RegExp('<head[\\s\\S]*?<\\/head>','i').test(html)) { toast('No se encontr√≥ <head>. Se restableci√≥ el esqueleto.'); html = getInitialPage(); }
            html = html.replace(new RegExp('<\\/head>','i'), '  \n  '+tpl+'\n</head>');
        }else if(section==='body' || section==='any' || section==='pre'){
            if(new RegExp('<main[^>]*id=[\'"]app[\'"][^>]*>','i').test(html)){
                html = html.replace(new RegExp('<\\/main>','i'), '  \n  '+tpl+'\n  </main>');
            }else if(new RegExp('<body[\\s\\S]*?<\\/body>','i').test(html)){
                html = html.replace(new RegExp('<\\/body>','i'), '  \n  '+tpl+'\n</body>');
            }else{
                toast('No se encontr√≥ <body>. Se restableci√≥ el esqueleto.');
                html = getInitialPage().replace(new RegExp('<\\/main>','i'), '  \n  '+tpl+'\n  </main>');
            }
        }
        els.pageInput.value = html; savePage(html); renderPagePreview(); toast('Insertado <'+t.name+'>');
    }

    function isPageCorrectForTag(){
        var t = tags[index];
        var html = (els.pageInput.value||'').trim();
        if(!html){ return {ok:false, hint:'Escribe o inserta el esqueleto de la p√°gina.'}; }
        if(!new RegExp('<!doctype html>','i').test(html) ||
            !new RegExp('<html[^>]*>','i').test(html) ||
            !new RegExp('<head[^>]*>','i').test(html) ||
            !new RegExp('<\\/head>','i').test(html) ||
            !new RegExp('<body[^>]*>','i').test(html) ||
            !new RegExp('<\\/body>','i').test(html)){
            return {ok:false, hint:'La p√°gina debe tener <!doctype>, <html>, <head> y <body>.'};
        }
        var section = expectedSectionForTag(t.name);
        if(section==='pre'){ return {ok:true}; }
        var inHead = hasTag(sectionContent(html,'head'), t.name, t.void);
        var inBody = hasTag(sectionContent(html,'body'), t.name, t.void);
        var exists = inHead || inBody;
        if(!exists){
            return {ok:false, hint:'A√±ade <'+t.name+'> a la secci√≥n correcta ('+(section==='head'?'head':'body')+').' };
        }
        if(section==='head' && !inHead){ return {ok:false, hint:'<'+t.name+'> debe ir en <head>.'}; }
        if(section==='body' && !inBody){ return {ok:false, hint:'<'+t.name+'> debe ir en <body> (mejor en <main id="app">).'}; }
        return {ok:true};
    }

    function renderTag(i){
        var t=tags[i]; index=i; selectedOption=null; els.feedback.textContent='';
        els.category.textContent=t.category;
        els.tagname.textContent='<'+t.name+'>';
        els.definition.textContent=t.definition;
        els.example.innerHTML=highlight(t.example);
        els.question.textContent='Reto 1: '+t.question.prompt;
        renderOptions(t);
        setupBuilder(t);
        updateList();
    }

    function renderOptions(t){
        els.options.innerHTML='';
        t.question.options.forEach(function(opt,idx){
            var a=document.createElement('a'); a.href='#'; a.className='option'; a.textContent=opt; a.setAttribute('role','button');
            a.addEventListener('click',function(e){e.preventDefault(); $$('.option').forEach(function(o){o.classList.remove('selected')}); a.classList.add('selected'); selectedOption=idx;});
            els.options.appendChild(a);
        });
    }

    /* Configuraci√≥n del builder de p√°gina */
    function setupBuilder(t){
        els.builderHint.textContent = 'Problema simple: a√±ade <'+t.name+'> en la secci√≥n correcta y mant√©n tu documento v√°lido. Usa ‚ÄúInsertar etiqueta actual‚Äù para empezar m√°s r√°pido.';
        if(!els.pageInput.value){ els.pageInput.value = loadPage(); }
        els.pageInput.oninput = function(){ savePage(els.pageInput.value); renderPagePreview(); };
        renderPagePreview();
    }

    function updateProgress(){
        var mastered=tags.filter(function(t){return t.mastered}).length;
        els.mastered.textContent=mastered;
        var pct=Math.round((mastered/tags.length)*100);
        els.progress.style.width=pct+'%';
        els.xp.textContent=xp;
        if(mastered===5) addBadge('Explorador','üß≠');
        if(mastered===10) addBadge('Estudioso','üìö');
        if(mastered===20) addBadge('Maestro de etiquetas','üèÜ');
    }

    function addBadge(text,icon){
        if([].slice.call(els.badges.children).some(function(b){return b.dataset.text===text})) return;
        var b=document.createElement('div'); b.className='badge'; b.dataset.text=text; b.textContent=icon+' '+text; els.badges.appendChild(b);
        confettiBurst(36); toast('¬°Nueva insignia: '+text+'!');
    }

    function updateList(){
        els.list.innerHTML='';
        tags.forEach(function(t,i){
            var div=document.createElement('div'); div.className='tagpill'+(t.mastered?'':' locked'); div.setAttribute('role','listitem');
            var left=document.createElement('span'); left.textContent='<'+t.name+'>';
            var right=document.createElement('span'); right.className='muted'; right.textContent=t.category;
            div.append(left,right);
            div.addEventListener('click',function(){ renderTag(i); window.scrollTo({top:0,behavior:'smooth'});});
            els.list.appendChild(div);
        });
    }

    function check(){
        if(selectedOption===null){ toast('Elige una opci√≥n en el Reto 1'); return; }
        var t=tags[index];
        var ok1=(selectedOption===t.question.correctIndex);
        var res2 = isPageCorrectForTag();
        var ok2 = res2.ok;
        if(ok1 && ok2){
            if(!t.mastered){ t.mastered=true; xp+=20; updateProgress(); }
            els.feedback.textContent='‚úÖ ¬°Perfecto! '+t.question.explanation+' y la etiqueta est√° correctamente integrada en tu p√°gina.';
            confettiBurst();
        }else{
            var msg='‚ùå ';
            if(!ok1) msg+='Revisa la opci√≥n del Reto 1. ';
            if(!ok2) msg+=(res2.hint||'Completa el problema del Reto 2.');
            els.feedback.textContent=msg; xp=Math.max(0,xp-2); updateProgress();
        }
    }

    $('#btnCheck').addEventListener('click',function(e){e.preventDefault(); check();});
    $('#btnNext').addEventListener('click',function(e){e.preventDefault(); renderTag((index+1)%tags.length);});
    $('#btnRandom').addEventListener('click',function(e){e.preventDefault(); renderTag(Math.floor(Math.random()*tags.length));});
    els.btnInsert.addEventListener('click', function(e){ e.preventDefault(); insertCurrentTag(); });
    els.btnReset.addEventListener('click', function(e){ e.preventDefault(); if(confirm('¬øRestablecer la p√°gina a un esqueleto b√°sico?')){ var html=getInitialPage(); els.pageInput.value=html; savePage(html); renderPagePreview(); toast('P√°gina restablecida'); }});

    /* Init */
    (function init(){ updateList(); renderTag(0); updateProgress(); if(!localStorage.getItem(PAGE_KEY)){ savePage(getInitialPage()); } })();
</script>
</body>
</html>
